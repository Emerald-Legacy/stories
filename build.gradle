import org.asciidoctor.gradle.jvm.AsciidoctorTask
import java.text.SimpleDateFormat

plugins {
    id "org.asciidoctor.jvm.base" version "3.3.2"
    id "org.asciidoctor.jvm.convert" version "3.3.2"
    id "org.asciidoctor.jvm.pdf" version "3.3.2"
}
repositories {
    mavenCentral()
}

asciidoctorj {
    version = '2.5.3'
}

ext {
    curriculumFileName = "stories"
}


class RenderCurriculumTask extends AsciidoctorTask {
    @Inject
    RenderCurriculumTask(WorkerExecutor we) {
        super(we)

        forkOptions {
            jvmArgs "--add-opens", "java.base/sun.nio.ch=ALL-UNNAMED", "--add-opens", "java.base/java.io=ALL-UNNAMED"
        }

        sourceDir = new File("./docs/stories")
        baseDir = new File ("./docs/")
        sources {
            include "**/*.adoc"
        }

        outputDir = new File("./build/")
        outputOptions {
            separateOutputDirs = false
            backends 'pdf'
        }


        attributes = [
                'icons'             : 'font',
                'version-label'     : '',
                'revnumber'         : '',
                'revdate'           : '',
                'document-version'  : '',
                'currentDate'       : '',
                'language'          : 'EN',
                'pdf-stylesdir'     : '../pdf-theme/themes',
                'pdf-fontsdir'      : '../pdf-theme/fonts',
                'pdf-style'         : 'el'
        ]
    }
}


task renderStories(type: RenderCurriculumTask,
        constructorArgs: [curriculumFileName]) {
}

defaultTasks "renderEN"
